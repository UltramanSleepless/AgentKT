# OKT数据集结构文档

## 数据集概述

本数据集是一个编程教育知识追踪（Knowledge Tracing）数据集，专门用于训练和评估OKT（Optimized Knowledge Tracing）模型。数据集包含学生编程练习的详细记录，包括代码、AST（抽象语法树）、嵌入向量等多种表示形式。

## 基本信息

- **数据集形状**: (39,796, 15) - 39,796条记录，15个特征列
- **学生数量**: 246个学生
- **问题数量**: 50个编程问题
- **作业数量**: 5个作业
- **平均每个学生的记录数**: 161.77条

## 数据列详细说明

### 1. 学生标识信息

#### SubjectID (object)
- **描述**: 学生唯一标识符
- **类型**: 字符串（MD5哈希值）
- **示例**: `"04c32d4d95425f73b3a1d6502aed4d48"`
- **唯一值数量**: 246

#### AssignmentID (float64)
- **描述**: 作业标识符
- **类型**: 数值
- **范围**: 439.0 - 502.0
- **唯一值数量**: 5
- **含义**: 标识学生完成的是哪个作业

#### ProblemID (int64)
- **描述**: 编程问题标识符
- **类型**: 整数
- **范围**: 1 - 236
- **唯一值数量**: 50
- **含义**: 标识具体的编程问题

#### CodeStateID (object)
- **描述**: 代码状态唯一标识符
- **类型**: 字符串（SHA-1哈希值）
- **示例**: `"4531059d41ba170482b4e43d4d94d857c0e45dbb"`
- **唯一值数量**: 39,796（每条记录都唯一）
- **含义**: 标识学生提交的代码的特定状态

### 2. 评分信息

#### Score_x (float64)
- **描述**: 原始评分（连续值）
- **类型**: 浮点数
- **范围**: 0.0 - 1.0
- **平均值**: 0.497
- **唯一值数量**: 200
- **含义**: 学生代码的原始评分，可能是基于测试用例通过率的连续分数

#### Score_y (int64)
- **描述**: 离散评分
- **类型**: 整数
- **范围**: 0 - 2
- **分布**: 
  - 0: 完全错误
  - 1: 部分正确
  - 2: 完全正确
- **含义**: 学生代码的离散评分等级

### 3. 代码相关数据

#### Code (object)
- **描述**: 学生提交的原始代码
- **类型**: 字符串
- **唯一值数量**: 35,484
- **示例**:
```java
public int sortaSum(int a, int b)
{
    if (a + b >= 10)
    {
        if (a + b <= 19)
        {
            return 20;
        }
        return a + b;
    }
    else
    {
        return a + b;
    }
}
```

#### Code-ast (object)
- **描述**: 代码的抽象语法树（AST）表示
- **类型**: 复杂嵌套字典结构
- **唯一值数量**: 39,796
- **结构**: 包含完整的Java代码AST，包括方法声明、参数、语句、表达式等
- **示例结构**:
```json
{
  "documentation": null,
  "modifiers": "{'public'}",
  "annotations": [],
  "type_parameters": null,
  "return_type": {"name": "int", "dimensions": []},
  "name": "sortaSum",
  "parameters": [...],
  "body": [...]
}
```

#### code-astnn (object)
- **描述**: 用于神经网络处理的AST序列化表示
- **类型**: 字符串
- **唯一值数量**: 29,104
- **示例**: `"MethodDeclaration Modifier public BasicType int sortaSum FormalParameter BasicType int a ..."`
- **含义**: 将AST转换为适合神经网络处理的序列格式

#### code-embedding (object)
- **描述**: 代码的嵌入向量表示
- **类型**: 嵌套列表
- **结构**: 多层嵌套的整数列表，表示代码的向量化特征
- **示例**:
```python
[
  28,
  [26, [27]],
  [3, [4]],
  [248],
  [13, [3, [4]], [23]],
  [13, [3, [4]], [24]]
]
```

### 4. 问题相关数据

#### prompt (object)
- **描述**: 编程问题的题目描述
- **类型**: 字符串
- **唯一值数量**: 50（每个问题一个）
- **示例**: `"Given 2 ints, a and b, return their sum. However, "sums" in the range 10..19 inclusive, are forbidden, so in that case just return 20."`

#### prompt-embedding (object)
- **描述**: 问题描述的嵌入向量
- **类型**: 列表（浮点数向量）
- **维度**: 通常为高维向量（如768维或1024维）
- **含义**: 问题文本的向量化表示，用于语义理解

### 5. 综合特征

#### embedding (object)
- **描述**: 综合嵌入向量（可能结合了代码和问题信息）
- **类型**: 列表（浮点数向量）
- **含义**: 结合多种信息的综合特征表示

#### astnn (object)
- **描述**: 用于AST神经网络的特殊表示
- **类型**: 复杂对象
- **含义**: 专门为AST神经网络设计的特征表示

#### input (object)
- **描述**: 模型输入特征向量
- **类型**: 列表（浮点数向量）
- **含义**: 经过预处理后直接输入到模型的特征向量

## 数据使用方式

### 1. 标签选择
根据`configs.label_type`参数，可以选择不同的标签格式：
- `'binary'`: 将Score_y >= 2的设为1，否则为0
- `'ternery'`: 直接使用Score_y (0, 1, 2)
- `'raw'`: 使用Score_x (连续值)

### 2. 数据分割
- **LSTM模式**: 按学生分割，确保同一学生的数据不会同时出现在训练集和测试集中
- **OKT模式**: 可选择按学生分割或按条目分割

### 3. 序列长度控制
- 通过`configs.max_len`参数控制每个学生序列的最大长度
- 超过最大长度的序列会被分割成多个"虚拟学生"

### 4. 知识组件（可选）
- 如果`configs.use_kc=True`，会加载`prompt_concept.xlsx`文件
- 为每个问题添加知识组件向量表示

## 数据预处理流程

1. **加载原始数据**: 从`dataset.pkl`加载
2. **标签处理**: 根据配置选择标签格式
3. **序列分割**: 处理超长学生序列
4. **嵌入转换**: 将嵌入向量转换为PyTorch张量
5. **数据分割**: 按学生或条目分割训练/验证/测试集

## 注意事项

1. **内存使用**: 数据集包含大量嵌入向量和复杂对象，内存占用较大
2. **序列长度**: 不同学生的练习序列长度差异很大
3. **代码唯一性**: 大部分代码都是唯一的，体现了编程问题的多样性
4. **评分分布**: Score_y的分布显示大部分代码都是完全正确的（值为2）

## 文件依赖

- `dataset.pkl`: 主数据集文件
- `prompt_concept.xlsx`: 知识组件映射文件（可选）
- `data_info.json`: 数据集分析结果文件

这个数据集为编程教育中的知识追踪研究提供了丰富的信息，包括代码的多种表示形式、学生的练习历史和详细的评分信息。
